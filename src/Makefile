# Makefile for door library for Unix.
# Copyright (c) 2003 by M. Broek.
# $Id$

include ../Makefile.global

SRCS		= input.c  output.c  xmalloc.c  doorsys.c  timeout.c  logger.c  parse.c  dispfile.c
OBJS		= input.o  output.o  xmalloc.o  doorsys.o  timeout.o  logger.o  parse.o  dispfile.o
LOBJS		= input.lo output.lo xmalloc.lo doorsys.lo timeout.lo logger.lo parse.lo dispfile.lo
HDRS		= door.h
OTHER		= Makefile
TARGET		= libdoor.a libdoor.la

#############################################################################################################

.c.o:
		libtool --mode=compile ${CC} ${CFLAGS} -c $<

all:		${TARGET}

clean: 
		rm -Rf ${TARGET} *.o *.lo *.la *.h~ *.c~ core filelist Makefile.bak .libs

libdoor.a:	${OBJS}
		ar cru libdoor.a ${OBJS}
		ranlib libdoor.a

libdoor.la:	${OBJS}
		libtool --mode=link ${CC} -g -O -o libdoor.la ${LOBJS} -release "${VERSION}" -rpath ${DESTDIR}${LIBDIR}

install:	all
		mkdir -p ${DESTDIR}${LIBDIR}
		libtool cp libdoor.la ${DESTDIR}${LIBDIR}/libdoor.la
		mkdir -p ${DESTDIR}${INCDIR}
		cp ${HDRS} ${DESTDIR}${INCDIR}

uninstall:
		rm -f ${DESTDIR{${INCDIR}/door.h
		rm -f ${DESTDIR}${LIBDIR}/libdoor.*

filelist:	Makefile
		BASE=`pwd`; \
		BASE=`basename $${BASE}`; \
		(for f in ${SRCS} ${HDRS} ${OTHER} ; do echo ${PACKAGE}-${VERSION}/$${BASE}/$$f; done) >filelist

depend:
		@rm -f Makefile.bak; \
		mv Makefile Makefile.bak; \
		sed -e '/^# DO NOT DELETE/,$$d' Makefile.bak >Makefile; \
		${ECHO} '# DO NOT DELETE THIS LINE - MAKE DEPEND RELIES ON IT' \
		>>Makefile; \
		${ECHO} '# Dependencies generated by make depend' >>Makefile; \
		for f in ${SRCS}; \
		do \
		${ECHO} "Dependencies for $$f:\c"; \
		${ECHO} "`basename $$f .c`.o:\c" >>Makefile; \
		for h in `sed -n -e \
			's/^#[ 	]*include[ 	]*"\([^"]*\)".*/\1/p' $$f`; \
		do \
			${ECHO} " $$h\c"; \
			${ECHO} " $$h\c" >>Makefile; \
		done; \
		${ECHO} " done."; \
		${ECHO} "" >>Makefile; \
		done; \
		${ECHO} '# End of generated dependencies' >>Makefile

# DO NOT DELETE THIS LINE - MAKE DEPEND RELIES ON IT
# Dependencies generated by make depend
input.o: ../config.h door.h
output.o: ../config.h door.h
xmalloc.o: ../config.h door.h
doorsys.o: ../config.h door.h
timeout.o: ../config.h door.h
logger.o: ../config.h door.h
parse.o: ../config.h door.h
dispfile.o: ../config.h door.h
# End of generated dependencies
